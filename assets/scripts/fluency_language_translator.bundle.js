!function n(s,i,r){function l(t,e){if(!i[t]){if(!s[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(o)return o(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}a=i[t]={exports:{}},s[t][0].call(a.exports,function(e){return l(s[t][1][e]||e)},a,a.exports,n,s,i,r)}return i[t].exports}for(var o="function"==typeof require&&require,e=0;e<r.length;e++)l(r[e]);return l}({1:[function(e,t,a){"use strict";var n=i(e("./inputfields/FtLanguageTranslatorInputfields")),s=i(e("./global/FtConfig"));function i(e){return e&&e.__esModule?e:{default:e}}window.addEventListener("load",e=>{console.log(s.default),s.default.moduleShouldInitialize()&&n.default.init()})},{"./global/FtConfig":3,"./inputfields/FtLanguageTranslatorInputfields":4}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var u=(e=e("./FtConfig"))&&e.__esModule?e:{default:e};e=function(){const a=u.default.getUiTextFor("errors");const r=e=>{var t={"X-Requested-With":"XMLHttpRequest"};return"GET"===e&&(t.Accept="application/json"),"POST"===e&&(t["Content-Type"]="application/json"),t},e=(e,t)=>fetch(e,{method:"GET",cache:"no-store",headers:r("GET")}).then(l).then(t).catch(o),t=(e,t)=>fetch(e,{method:"DELETE",headers:r("GET")}).then(l).then(t).catch(o),l=e=>{if(204===e.status)return e;if(e.ok)return e.json();throw new Error},o=e=>{console.error("[Fluency module API failure]",e.message);var t={error:null,message:null};return"NetworkError"===e.message.split(" ")[0]?(t.error="FLUENCY_CLIENT_DISCONNECTED",t.message=a.FLUENCY_CLIENT_DISCONNECTED):(t.error="UNKNOWN_ERROR",t.message=a.UNKNOWN_ERROR),t};return{deleteTranslatableLanguagesCache:()=>t(u.default.getApiEndpointFor("translatableLanguagesCache"),e=>e),deleteTranslationCache:()=>t(u.default.getApiEndpointFor("translationCache"),e=>e),getAvailableLanguages:()=>e(u.default.getApiEndpointFor("languages"),e=>e),getTranslation:function(e,t,a){var n,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return n=u.default.getApiEndpointFor("translation"),e={sourceLanguage:e,targetLanguage:t,content:a,options:s,caching:i},t=e=>e,fetch(n,{method:"POST",cache:"no-store",headers:r,body:JSON.stringify(e)}).then(l).then(t).catch(o)},getUsage:()=>e(u.default.getApiEndpointFor("usage"),e=>e)}}();a.default=e},{"./FtConfig":3}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=function(){const e=ProcessWire.config.fluency;var t=e.localization;const a={translateButton:{container:"ft-translate-button-container",button:"ft-translate-button"},languageTranslator:{container:"Inputfield InputfieldHeaderHidden",content:"InputfieldContent ft-language-translator-button-content",translateButton:"ft-translate-all-button",sourceLanguageSelect:"uk-select ft-source-language-select",sourceLanguageSelectLabel:"ft-source-language-select-label"},statusPlaceholder:{container:"ft-translation-status-container",label:"ft-translation-status"},icon:"ft-icon"},n={activityOverlay:t.activityOverlay,languageSelect:t.languageSelect,inputfieldTranslateButtons:t.inputfieldTranslateButtons,standaloneTranslator:t.standaloneTranslator,usage:t.usage,errors:t.errors,languageTranslator:t.languageTranslator},s={languages:e.apiEndpoints.languages,translatableLanguagesCache:e.apiEndpoints.translatableLanguagesCache,test:e.apiEndpoints.test,translation:e.apiEndpoints.translation,translationCache:e.apiEndpoints.translationCache,usage:e.apiEndpoints.usage},i=e.configuredLanguages,r=e.unconfiguredLanguages;const l=()=>i;const o=()=>r;const u=()=>e.engine;return{fieldInitializedAttr:"data-ft-initialized",getApiEndpointFor:e=>s[e],getConfiguredLanguages:l,getDefaultLanguage:()=>i.reduce((e,t)=>t.default?t:e,null),getElementClassesFor:e=>a[e],getEngineInfo:u,getEngineProvidesUsageData:()=>u().providesUsageData,getLanguageCount:()=>i.length+r.length,getLanguageForId:a=>(a=parseInt(a,10),i.reduce((e,t)=>t.id===a?t:e,null)),getTranslationAction:()=>e.interface.inputfieldTranslationAction,getTranslationDisabledFieldAttribute:()=>`[${e.interface.translationDisabledFieldAttr}]`,getUiTextFor:e=>n[e],getUnconfiguredLanguages:o,languageIsTranslatable:e=>!r.includes(parseInt(e,10)),moduleShouldInitialize:()=>1<i.length,translationActionTypes:{each:"translate_each_language",all:"translate_to_all_languages",both:"both"}}}();a.default=n},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=n(e("../ui/FtActivityOverlay")),o=n(e("../ui/FtUiElements")),u=n(e("../global/FtConfig")),c=n(e("../global/Fluency"));function n(e){return e&&e.__esModule?e:{default:e}}const s=function(e){let r,a=[];this.getSelf=()=>e,this.getActivityOverlay=()=>r,this.addLanguageTranslatorInputs=()=>{var{translateAllButton:e,sourceLanguageSelect:t,container:a}=o.default.createLanguageTranslatorInputs();this.sourceLanguageSelect=t,this.bindSourceLanguageSelect(t),this.bindTranslateButton(e),document.querySelector(".Inputfields").insertAdjacentElement("afterbegin",a)},this.bindSourceLanguageSelect=e=>{e.addEventListener("change",e=>{setTimeout(()=>{e.target.closest(".InputfieldStateChanged")?.classList.remove("InputfieldStateChanged")},100)})},this.bindTranslateButton=e=>{e.addEventListener("click",e=>{e.preventDefault(),this.translateContent()})},this.getGroupedContentForTranslation=()=>{return a.reduce((e,t,a)=>{a=Math.floor(a/40);return e[a]||(e[a]=[]),e[a].push(t),e},[])},this.translateContent=()=>{var e=this.getGroupedContentForTranslation();r.showActivity();let t=e.length;var a=new URLSearchParams(window.location.search);const n=parseInt(a.get("language_id"));let s=!1;const i=this.sourceLanguageSelect.value;e.forEach((a,e)=>{s||c.default.getTranslation(i,u.default.getLanguageForId(n).engineLanguage.targetCode,a.map(e=>e.text)).then(e=>{if(e.error)s||(r.showError(e.message),s=!0);else{var t=e.translations;if(a.length!==t.length)r.showError("Error"),s=!0;else for(let e=0;e<t.length;e++)a[e].input.value=t[e]}}).then(e=>{0!==--t||s||r.hide()})})},this.mapSourceTargetElements=()=>{[...document.querySelectorAll(".InputfieldContent")].forEach(e=>{var t=e.querySelector(".description"),e=e.querySelector("input.translatable, textarea.translatable");e&&t&&t.innerText&&a.push({text:t.innerText,input:e})})},r=new l.default(this),this.mapSourceTargetElements(),this.addLanguageTranslatorInputs()},i=function(a){const n=u.default.getUiTextFor("inputfieldTranslateButtons");let t,s=a.querySelector(".description").innerText,i=a.querySelector("input, textarea");this.getSelf=()=>a,this.getActivityOverlay=()=>t,this.addLanguageTranslatorInputs=()=>{var{button:e,container:t}=o.default.createTranslateButton(n.translate);this.bindTranslateButton(e),a.appendChild(t)},this.bindTranslateButton=e=>{e.addEventListener("click",e=>{e.preventDefault(),this.translateContent()})},this.getSourceLanguageCode=()=>{var e=u.default.getElementClassesFor("languageTranslator").sourceLanguageSelect;return document.querySelector("."+e.split(" ").join(".")).value},this.translateContent=()=>{var e=new URLSearchParams(window.location.search),e=parseInt(e.get("language_id"));t.showActivity(),c.default.getTranslation(this.getSourceLanguageCode(),u.default.getLanguageForId(e).engineLanguage.targetCode,s).then(e=>{e.error?t.showError(e.message):(i.value=e.translations[0],t.hide())})},t=new l.default(this),this.addLanguageTranslatorInputs()};a.default={init:()=>{{var e=document.querySelectorAll(".InputfieldContent");e&&[...e].forEach(e=>{e.querySelector("input.translatable, textarea.translatable")&&new i(e)})}{var t=document.querySelector(".Inputfields");new s(t)}}}},{"../global/Fluency":2,"../global/FtConfig":3,"../ui/FtActivityOverlay":5,"../ui/FtUiElements":6}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=(e=e("../global/FtConfig"))&&e.__esModule?e:{default:e};a.default=function(e){var a=this;let s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"translating";const n={parent:"ft-activity-overlay-container",overlay:"ft-activity-overlay",error:"error",message:"message",flash:"flash",success:"success",activity:"activity",visible:"visible",activityContainer:"ft-activity",activityStaticText:"ft-activity-text",activityAnimationContainer:"ft-activity-animation-container",activityAnimationItem:"ft-activity-animation-item",messageContainer:"ft-activity-message"};let t,i,r;this.showActivity=()=>{this.setActivityActive(),this.setOverlayVisible()},this.showMessage=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5e3;a.setMessageContent(e),a.setActivityInactive(),a.setMessageActive(),a.setOverlayVisible(),a.hide(t)},this.flashSuccess=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;a.setSuccessActive(),a.setFlashActive(),a.showMessage(e,t)},this.flashError=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;a.setFlashActive(),a.setErrorActive(),a.showMessage(e,t)},this.showError=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:7e3;a.setErrorActive(),a.showMessage(e,t)},this.hide=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;setTimeout(()=>{a.setOverlayInvisible()},e),setTimeout(()=>{a.setActivityInactive(),a.setMessageInactive(),a.setErrorInactive(),a.setFlashInactive(),a.setMessageContent("")},e+500)},this.setActivityActive=()=>{t.classList.add(n.activity)},this.setActivityInactive=()=>{t.classList.remove(n.activity)},this.setMessageActive=()=>{t.classList.add(n.message)},this.setMessageInactive=()=>{t.classList.remove(n.message)},this.setMessageContent=e=>{i.innerText=e},this.setFlashActive=e=>{t.classList.add(n.flash)},this.setFlashInactive=e=>{t.classList.remove(n.flash)},this.setSuccessActive=()=>{t.classList.add(n.success)},this.setSuccessInactive=()=>{t.classList.remove(n.success)},this.setErrorActive=()=>{t.classList.add(n.error)},this.setErrorInactive=()=>{t.classList.remove(n.error)},this.setOverlayVisible=()=>{t.classList.add(n.visible)},this.setOverlayInvisible=()=>{t.classList.remove(n.visible)},this.create=()=>(t=this.buildOverlayEl(),r=this.buildActivityEl(),i=this.buildMessageEl(),t.appendChild(r),t.appendChild(i),t),this.buildOverlayEl=()=>{var e=document.createElement("div");return e.setAttribute("class",n.overlay),e},this.buildActivityEl=()=>{var e=this.getActivityTexts();let t=document.createElement("div");t.setAttribute("class",n.activityAnimationContainer),t=e.animated.reduce((e,t)=>{var a=document.createElement("span");return a.setAttribute("class",n.activityAnimationItem),a.innerHTML=t,e.appendChild(a),e},t);var a=document.createElement("div");return a.setAttribute("class",n.activityStaticText),a.innerText=e.static,(r=document.createElement("div")).setAttribute("class",n.activityContainer),r.appendChild(a),r.appendChild(t),r},this.getActivityTexts=()=>{var e=l.default.getUiTextFor("activityOverlay")[s],t=e.animated;for(let e=t.length-1;0<e;e--){var a=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[a],t[a]=n}return e.animated=t,e},this.buildMessageEl=()=>((i=document.createElement("div")).setAttribute("class",n.messageContainer),i),e=e.getSelf(),t=this.create(),e.classList.add(n.parent),e.appendChild(t)}},{"../global/FtConfig":3}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i=n(e("../global/FtConfig"));n(e("../global/Fluency"));function n(e){return e&&e.__esModule?e:{default:e}}e=function(){var e=i.default.elementClasses;const a=i.default.getUiTextFor("inputfieldTranslateButtons"),n=()=>{var e=document.createElement("a"),t=(e.setAttribute("href",ProcessWire.config.urls.admin+"fluency/?modal=1"),e.setAttribute("class","pw-modal pw-modal-large"),document.createElement("i"));return t.setAttribute("class",i.default.getElementClassesFor("icon")+" fa fa-language"),t.setAttribute("uk-tooltip",a.showTranslator),e.appendChild(t),e};return{createStatusElement:e=>{var t=i.default.getElementClassesFor("statusPlaceholder"),a=document.createElement("span"),e=(a.setAttribute("class",t.label),a.innerText=e,document.createElement("div"));return e.setAttribute("class",t.container),e.appendChild(n()),e.appendChild(a),e},createTranslateButton:e=>{var t=i.default.getElementClassesFor("translateButton"),a=document.createElement("a"),e=(a.innerText=e,a.setAttribute("class",t.button),a.setAttribute("href",""),document.createElement("div"));return e.setAttribute("class",t.container),e.appendChild(n()),e.appendChild(a),{button:a,container:e}},createLanguageTranslatorInputs:()=>{var e=i.default.getElementClassesFor("languageTranslator"),t=i.default.getUiTextFor("languageTranslator"),a=document.createElement("a");a.innerText=t.translateAllButton,a.setAttribute("class",e.translateButton),a.setAttribute("href","");const n=document.createElement("select");n.setAttribute("class",e.sourceLanguageSelect),i.default.getConfiguredLanguages().forEach(function(e){var t=document.createElement("option");t.textContent=e.title,t.value=e.engineLanguage.sourceCode,e.default?(t.selected="selected",n.prepend(t)):n.appendChild(t)});var s=document.createElement("span"),t=(s.innerText=t.sourceLanguageSelectLabel,document.createElement("label")),s=(t.setAttribute("class",e.sourceLanguageSelectLabel),t.appendChild(s),t.appendChild(n),document.createElement("div")),t=(s.setAttribute("class",e.content),s.appendChild(a),s.appendChild(t),document.createElement("li"));return t.setAttribute("class",e.container),t.appendChild(s),{translateAllButton:a,sourceLanguageSelect:n,container:t}},createIcon:n,elementClasses:e}}();a.default=e},{"../global/Fluency":2,"../global/FtConfig":3}]},{},[1]);
//# sourceMappingURL=maps/fluency_language_translator.bundle.js.map
